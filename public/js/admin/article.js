define(["jquery","ueditor","zeroclipboard","ajax","datetimepicker","datetimepicker-lang","ueditor-lang","bootstrap"],function(a,t,e,i){function o(t){if(t){var e=!1;if(a(".tag","#tagBox").each(function(){if(a(this).data("tag")==t)return e=!0,!1}),!e){var i=a('<div class="tag pull-left" style="margin-right: 5px;">                    <span class="glyphicon glyphicon-remove-sign"></span>                    <a href="javascript:void(0);"></a>                    <input type="hidden" name="tag[]" role="tag">                    </div>');i.attr("data-tag",t).data("tag",t),i.find("a").html(t),i.find("[role=tag]").val(t),a("#tagBox").append(i),i.find(".glyphicon-remove-sign").click(function(){i.remove()})}}}var n={tagOption:function(){a("#btnAddTag").click(function(){var t=a("#iptTags").val().split(",");a("#iptTags").val("");for(var e in t)o(t[e])}),a("#btnAllTagBox").click(function(){a("#allTagBox").hasClass("hide")?a("#allTagBox").removeClass("hide"):a("#allTagBox").addClass("hide")}),a(".tag","#allTagBox").click(function(){o(a(this).html())})},preview:function(){a("#btnPreview").click(function(){var t=document.createElement("form"),e=a.extend(this.form,{});e._token=a('meta[name="csrf-token"]').attr("content"),t.action="/article-manage/markdown/preview",t.method="POST",t.style.display="none",t.target="_blank",a.each(a("#dataForm").serializeArray(),function(a,e){var i=document.createElement("textarea");i.name=e.name,i.value=e.value,t.appendChild(i)}),document.body.appendChild(t),t.submit(),t.remove()})},coverOption:function(t){var e=this;a("input[name=cover_type]").click(function(){1==a(this).val()?(a("#cover-box").addClass("hide"),a("#img-cover-url").attr("src",""),a("[name=cover_url]").val("")):(2==a(this).val()?a("#img-cover-url").addClass("small").removeClass("big"):a("#img-cover-url").addClass("big").removeClass("small"),a("#cover-box").removeClass("hide"))}),a("#btn-cover-choose").click(function(){var i=a('<div class="modal fade" tabindex="-1" role="dialog">                                      <div class="modal-dialog" role="document">                                        <div class="modal-content">                                          <div class="modal-header">                                            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>                                            <h4 class="modal-title">请选择</h4>                                          </div>                                          <div class="modal-body">                                            <div class="row"><div class="col-xs-12 modal-images-list"></div></div>                                          </div>                                          <div class="modal-footer">                                            <button type="button" class="btn btn-primary btn-ok">确定</button>                                          </div>                                        </div>                                      </div>                                    </div>'),o=i.find(".modal-images-list"),n=[];a(t.getContent()).find("img").each(function(){a.inArray(a(this).attr("src"),n)<0&&n.push(a(this).attr("src"))}),a.each(n,function(t,e){var i=a('<div class="modal-images-item"><img></div>');i.children("img").attr("src",e),i.click(function(){o.find(".modal-images-item").removeClass("active"),a(this).addClass("active")}),o.append(i)}),i.find(".btn-ok").click(function(){e.loadCover(o.find(".active img").attr("src")),i.modal("toggle").on("hidden.bs.modal",function(){i.remove()})}),i.modal()}),a("#btn-cover-upload").click(function(){var t=a('<form><input type="file" accept="image/*" name="file"><input type="hidden" name="token"></form>');t.find("[name=token]").val(a("#uploadToken").html()),t.hide(),a("body").append(t),t.find("[name=file]").on("change",function(){var o=t[0];a.ajax({url:"http://up-z2.qiniu.com/",type:"POST",data:new FormData(o),cache:!1,contentType:!1,processData:!1,beforeSend:function(){i.loading()},complete:function(){t.remove(),i.removeLoading()},success:function(a){"SUCCESS"==a.state&&a.url?e.loadCover(a.url):alert(a.state)},error:function(a){alert("上传失败")}})}).click()})},loadCover:function(t){a("#img-cover-url").attr("src",t),a("[name=cover_url]").val(t)},init:function(){window.ZeroClipboard=e,window.uploadToken=a("#uploadToken").html();var i=t.getEditor("editor");a(".datetimepicker").datetimepicker({format:"yyyy-mm-dd",language:"zh-CN",minView:2,maxView:"year",autoclose:!0,todayBtn:!0,todayHighlight:!0,weekStart:0}),this.tagOption(),this.preview(),this.coverOption(i)},addTag:o};return n.init(),n});