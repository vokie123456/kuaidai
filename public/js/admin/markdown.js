define(["vue","uploader","jquery","restful","bootstrap","hyperdown","vue-datetime-picker","css!/css/admin/article.css"],function(e,t,a,n){e.config.debug=!0;var i=window.HyperDown,o=new i,s=new t(a("#uploadToken").html());new e({el:"#container",data:{form:{},preview:"",isShowCoverBox:!1,isShowAllTagBox:!1,isCreated:!1,iptTags:""},methods:{coverUpload:function(){var e=this;s.upload(function(t){e.form.cover_url=t})},coverChoose:function(){var e=this,t=a('<div class="modal fade" tabindex="-1" role="dialog">                                      <div class="modal-dialog" role="document">                                        <div class="modal-content">                                          <div class="modal-header">                                            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>                                            <h4 class="modal-title">请选择</h4>                                          </div>                                          <div class="modal-body">                                            <div class="row"><div class="col-xs-12 modal-images-list"></div></div>                                          </div>                                          <div class="modal-footer">                                            <button type="button" class="btn btn-primary btn-ok">确定</button>                                          </div>                                        </div>                                      </div>                                    </div>'),n=t.find(".modal-images-list"),i=[];a(this.preview).find("img").each(function(){a.inArray(a(this).attr("src"),i)<0&&i.push(a(this).attr("src"))}),a.each(i,function(e,t){var i=a('<div class="modal-images-item"><img></div>');i.children("img").attr("src",t),i.click(function(){n.find(".modal-images-item").removeClass("active"),a(this).addClass("active")}),n.append(i)}),t.find(".btn-ok").click(function(){e.form.cover_url=n.find(".active img").attr("src"),t.modal("toggle").on("hidden.bs.modal",function(){t.remove()})}),t.modal()},addIptTags:function(){var e=this.iptTags.split(",");this.iptTags="";var t=this;e.map(function(e){t.addTag(e)})},removeTag:function(e){this.form.tag.splice(e,1)},addTag:function(e){e&&a.inArray(e,this.form.tag)===-1&&this.form.tag.push(e)},submit:function(e){var t=e.target;n.post(t.action,this.form)},showPreview:function(){var e=document.createElement("form"),t=a.extend(this.form,{});t._token=a('meta[name="csrf-token"]').attr("content"),e.action="/article-manage/markdown/preview",e.method="POST",e.style.display="none",e.target="_blank",a.each(t,function(t,n){if("_method"!==t)if("object"==typeof n)a.each(n,function(a,n){var i=document.createElement("textarea");i.name=t+"[]",i.value=n,e.appendChild(i)});else{var i=document.createElement("textarea");i.name=t,i.value=n,e.appendChild(i)}}),document.body.appendChild(e),e.submit(),e.remove()},textareaKeyEvent:function(e){if(9===e.keyCode){e.preventDefault();var t=e.target,a=4,n=window.getSelection().toString();if(e.shiftKey){for(var i=t.value.substring(0,t.selectionEnd).replace(/\r\n/,"\n").replace(/\r/,"\n").split("\n").length-1,o=t.value.replace(/\r\n/,"\n").replace(/\r/,"\n").split("\n"),s=t.selectionStart,r=t.selectionEnd,l=0,d=0;d<a;d++)" "===o[i].substring(0,1)&&(l++,o[i]=o[i].substring(1,o[i].length));t.value=o.join("\r\n"),t.setSelectionRange(s-l,r-l)}else{for(var c="",d=0;d<a;d++)c+=" ";var s=t.selectionStart,r=t.selectionEnd;n=c+n.replace(/\n/g,"\n"+c),t.value=t.value.substring(0,s)+n+t.value.substring(r),t.setSelectionRange(s+c.length,s+n.length)}}}},watch:{"form.content":function(e){this.preview=o.makeHtml(e)},"form.cover_type":function(e){this.isShowCoverBox=1!==parseInt(e)}},created:function(){this.form=window.form},mounted:function(){a(this.$el).removeClass("hide")}})});